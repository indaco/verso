# Full plugin configuration example
# This demonstrates all available plugins working together

path: .version

plugins:
  # Commit Parser - Analyzes conventional commits to determine bump type
  # Enabled by default
  commit-parser: true

  # Release Gate - Pre-bump validation and quality gates
  release-gate:
    enabled: true
    require-clean-worktree: true
    blocked-on-wip-commits: true
    allowed-branches:
      - "main"
      - "release/*"
    blocked-branches:
      - "experimental/*"

  # Version Validator - Enforces versioning policies
  version-validator:
    enabled: true
    rules:
      # Only allow standard pre-release labels
      - type: pre-release-format
        pattern: "^(alpha|beta|rc)(\\.[0-9]+)?$"

      # Limit major version growth
      - type: major-version-max
        value: 10

      # Release branches: patch only
      - type: branch-constraint
        branch: "release/*"
        allowed: ["patch"]

      # Main branch: no major bumps
      - type: branch-constraint
        branch: "main"
        allowed: ["minor", "patch"]

  # Dependency Check - Validates and syncs versions across files
  dependency-check:
    enabled: true
    auto-sync: true
    files:
      # JSON format
      - path: package.json
        field: version
        format: json

      # YAML format
      - path: Chart.yaml
        field: version
        format: yaml

      # TOML format with nested field
      - path: pyproject.toml
        field: tool.poetry.version
        format: toml

      # Raw format (entire file content is the version)
      - path: VERSION
        format: raw

      # Regex format (pattern with capturing group)
      - path: src/version.go
        format: regex
        pattern: 'const Version = "(.*?)"'

  # Changelog Parser - Infers bump type from CHANGELOG.md
  changelog-parser:
    enabled: true
    path: CHANGELOG.md
    require-unreleased-section: true
    infer-bump-type: true
    priority: commits # "changelog" to prefer changelog over commits

  # Changelog Generator - Creates changelog entries from conventional commits
  changelog-generator:
    enabled: true
    mode: "both" # "versioned", "unified", or "both"
    # Formats: "grouped", "keepachangelog", "github", "minimal"
    format: "grouped"
    changes-dir: ".changes"
    changelog-path: "CHANGELOG.md"
    # header-template: ".changes/header.md"  # Custom header for unified changelog
    repository:
      auto-detect: true
    # Icon options (choose one approach):
    # use-default-icons: true  # Simplest: apply predefined icons to all groups
    # group-icons:             # Or: add icons to specific default groups
    #   Enhancements: "üöÄ"
    #   Fixes: "ü©π"
    # breaking-changes-icon: "üí•"  # Custom icon for Breaking Changes section (only applies to github and keepachangelog formats)
    groups:
      - pattern: "^feat"
        label: "New Features"
        icon: "üöÄ"
      - pattern: "^fix"
        label: "Bug Fixes"
        icon: "üêõ"
      - pattern: "^perf"
        label: "Performance"
        icon: "‚ö°"
      - pattern: "^refactor"
        label: "Refactoring"
        icon: "üíÖ"
      - pattern: "^docs?"
        label: "Documentation"
        icon: "üìñ"
      - pattern: "^test"
        label: "Tests"
        icon: "‚úÖ"
      - pattern: "^ci|^build"
        label: "CI/Build"
        icon: "ü§ñ"
      - pattern: "^chore"
        label: "Maintenance"
        icon: "üè°"
    exclude-patterns:
      - "^Merge"
      - "^WIP"
      - "^fixup!"
      - "^squash!"
    include-non-conventional: false # Include non-conventional commits in "Other Changes"
    contributors:
      enabled: true
      # format: "- [@{{.Username}}](https://{{.Host}}/{{.Username}})"
      # icon: "‚ù§Ô∏è"
      show-new-contributors: true
      # new-contributors-format: "- [@{{.Username}}](https://{{.Host}}/{{.Username}}) made their first contribution"
      # new-contributors-icon: "üéâ"

  # Tag Manager - Automatically creates git tags
  tag-manager:
    enabled: true
    auto-create: true
    prefix: v
    annotate: true
    push: false # Set to true for CI/CD pipelines

  # Audit Log - Records version changes with metadata
  audit-log:
    enabled: true
    path: ".version-history.json"
    format: "json"
    include-author: true
    include-timestamp: true
    include-commit-sha: true
    include-branch: true
