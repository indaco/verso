# Full plugin configuration example
# This demonstrates all available plugins working together

path: .version

plugins:
  # Commit Parser - Analyzes conventional commits to determine bump type
  # Enabled by default
  commit-parser: true

  # Release Gate - Pre-bump validation and quality gates
  release-gate:
    enabled: true
    require-clean-worktree: true
    blocked-on-wip-commits: true
    allowed-branches:
      - "main"
      - "release/*"
    blocked-branches:
      - "experimental/*"

  # Version Validator - Enforces versioning policies
  version-validator:
    enabled: true
    rules:
      # Only allow standard pre-release labels
      - type: pre-release-format
        pattern: "^(alpha|beta|rc)(\\.[0-9]+)?$"

      # Limit major version growth
      - type: major-version-max
        value: 10

      # Release branches: patch only
      - type: branch-constraint
        branch: "release/*"
        allowed: ["patch"]

      # Main branch: no major bumps
      - type: branch-constraint
        branch: "main"
        allowed: ["minor", "patch"]

  # Dependency Check - Validates and syncs versions across files
  dependency-check:
    enabled: true
    auto-sync: true
    files:
      - path: package.json
        field: version
        format: json

      - path: Chart.yaml
        field: version
        format: yaml

      - path: pyproject.toml
        field: tool.poetry.version
        format: toml

  # Changelog Parser - Infers bump type from CHANGELOG.md
  changelog-parser:
    enabled: true
    path: CHANGELOG.md
    require-unreleased-section: true
    infer-bump-type: true
    priority: commits # "changelog" to prefer changelog over commits

  # Changelog Generator - Creates changelog entries from conventional commits
  changelog-generator:
    enabled: true
    mode: "both" # "versioned", "unified", or "both"
    format: "grouped" # or "keepachangelog" for Keep a Changelog spec
    changes-dir: ".changes"
    changelog-path: "CHANGELOG.md"
    repository:
      auto-detect: true
    groups:
      - pattern: "^feat"
        label: "New Features"
      - pattern: "^fix"
        label: "Bug Fixes"
      - pattern: "^perf"
        label: "Performance"
      - pattern: "^refactor"
        label: "Refactoring"
      - pattern: "^docs?"
        label: "Documentation"
      - pattern: "^test"
        label: "Tests"
      - pattern: "^ci|^build"
        label: "CI/Build"
      - pattern: "^chore"
        label: "Maintenance"
    exclude-patterns:
      - "^Merge"
      - "^WIP"
    contributors:
      enabled: true

  # Tag Manager - Automatically creates git tags
  tag-manager:
    enabled: true
    auto-create: true
    prefix: v
    annotate: true
    push: false # Set to true for CI/CD pipelines

  # Audit Log - Records version changes with metadata
  audit-log:
    enabled: true
    path: ".version-history.json"
    format: "json"
    include-author: true
    include-timestamp: true
    include-commit-sha: true
    include-branch: true
